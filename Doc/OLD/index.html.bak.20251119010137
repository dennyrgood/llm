<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Project Docs Index — Doc/</title>
  <style>
    :root{
      --bg:#0f1720;
      --panel:#0b1220;
      --muted:#9aa4b2;
      --accent:#79c0ff;
      --accent-2:#7ee787;
      --card:#0f1726;
      --glass: rgba(255,255,255,0.03);
    }
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    body{display:flex;flex-direction:column;background:linear-gradient(180deg,#071422 0%, #071522 60%);color:#e6eef6}
    header{padding:18px 20px;border-bottom:1px solid rgba(255,255,255,0.03);display:flex;align-items:center;gap:18px}
    header h1{font-size:18px;margin:0}
    header p{margin:0;color:var(--muted);font-size:13px}
    main{display:flex;flex:1;overflow:hidden}
    /* left pane */
    #sidebar{width:420px;max-width:46%;min-width:300px;padding:18px;border-right:1px solid rgba(255,255,255,0.03);overflow:auto;background:linear-gradient(180deg, rgba(255,255,255,0.012), rgba(255,255,255,0.008));}
    .controls{display:flex;gap:8px;align-items:center;margin-bottom:14px}
    .search{flex:1;display:flex;align-items:center;background:var(--glass);padding:8px;border-radius:8px}
    .search input{flex:1;border:0;background:transparent;color:inherit;padding:6px 8px;font-size:14px;outline:none}
    .search small{color:var(--muted);font-size:12px;margin-left:6px}
    .category {margin-top:10px}
    .category h2{margin:6px 0 6px;font-size:13px;color:var(--accent)}
    ul.files{list-style:none;padding:0;margin:0}
    li.file{padding:10px;border-radius:8px;margin:6px 0;display:flex;gap:10px;align-items:flex-start;background:linear-gradient(180deg, rgba(255,255,255,0.008), rgba(255,255,255,0.006));cursor:pointer}
    li.file:hover{box-shadow:0 2px 14px rgba(2,6,23,0.6)}
    .file .meta{flex:1}
    .file .title{color:#dff3ff;font-weight:600;font-size:14px;margin-bottom:4px}
    .file .title a{color:inherit;text-decoration:none}
    .file .desc{font-size:13px;color:var(--muted);line-height:1.3}
    .file .tags{font-size:12px;color:var(--muted);margin-top:6px}
    .file .fmt{font-size:11px;padding:4px 6px;background:rgba(255,255,255,0.02);border-radius:6px;color:var(--muted);margin-left:6px}

    /* right pane viewer */
    #viewer{flex:1;display:flex;flex-direction:column;min-width:360px}
    #viewerHeader{padding:14px;border-bottom:1px solid rgba(255,255,255,0.03);display:flex;align-items:center;gap:12px}
    #viewerHeader h3{margin:0;font-size:15px}
    #viewerBody{padding:18px;overflow:auto;background:linear-gradient(180deg, rgba(255,255,255,0.006), rgba(255,255,255,0.004))}
    /* content area */
    #content{max-width:1000px;margin:0 auto}
    /* markdown container */
    #mdViewer{background:rgba(255,255,255,0.01);padding:18px;border-radius:8px}
    #mdViewer h1,#mdViewer h2,#mdViewer h3{color:#e8faff}
    pre code{background:#011627;color:#c9dfff;padding:8px;border-radius:6px;display:block;overflow:auto}
    a.inline-link{color:var(--accent);text-decoration:none}
    .small-muted{color:var(--muted);font-size:13px}

    /* RAW viewer: preserve CR/LF and indentation for text files */
    #rawViewer{
      display:none;
      background:rgba(255,255,255,0.02);
      padding:12px;
      border-radius:8px;
      color:var(--muted);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
      white-space: pre-wrap;        /* preserve newlines and wrap long lines */
      word-break: break-word;
      line-height:1.45;
      font-size:13px;
    }

    /* responsive */
    @media(max-width:980px){
      #sidebar{display:block;position:relative;width:100%;max-height:360px;overflow:auto}
      #viewer{min-height:calc(100vh - 360px)}
    }
  </style>
  <!-- marked.js for markdown rendering -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <header>
    <div style="display:flex;flex-direction:column">
      <h1>Project Docs Index</h1>
      <p>Browse Doc/ and Doc/md_outputs/ — click a file name to view it. Markdown is rendered client-side. PDFs open in an embedded viewer.</p>
    </div>
  </header>

  <main>
    <aside id="sidebar" aria-label="Docs list">
      <div class="controls">
        <div class="search">
          <svg width="16" height="16" viewBox="0 0 24 24" style="opacity:.7;margin-right:6px"><path fill="currentColor" d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l4.25 4.25 1.5-1.5L15.5 14z"></path></svg>
          <input id="searchInput" placeholder="Search files, descriptions, tags..." />
          <small id="resultCount"></small>
        </div>
        <div style="min-width:86px;text-align:right" class="small-muted">Click a file to preview</div>
      </div>

      <!-- Categories and files -->
      <div id="lists">
        <!-- Guides -->
        <section class="category" data-category="Guides">
          <h2>Guides (setup, long-form)</h2>
          <ul class="files" id="guidesList">
            <li class="file" data-path="./GROK.Ollama.on.Win11.Ultimate.Perf.Guide.md" data-pdf="./GROK.Ollama.on.Win11.Ultimate.Perf.Guide.md">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">GROK.Ollama.on.Win11.Ultimate.Perf.Guide.md</a></div>
                <div class="desc">Ollama on Windows 11 – Ultimate Performance Guide for RTX 3060: drivers, CUDA, Ollama settings, quantization, monitoring and model leaderboard.</div>
                <div class="tags small-muted">file: MD (searchable) &middot; category: Guides</div>
              </div>
            </li>

            <li class="file" data-path="./New RTX 3060 Setup - SETTING_UP_REAL_IMAGE_MANIPULATION_LOCAL_SERVER.md" data-pdf="./Setting Up Real Image Manipulation on Your Local Server.pdf">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">New RTX 3060 Setup - SETTING_UP_REAL_IMAGE_MANIPULATION_LOCAL_SERVER.md</a></div>
                <div class="desc">ComfyUI + Flux image pipeline step-by-step, ControlNet, workflows (background replace, restoration), and Open WebUI integration.</div>
                <div class="tags small-muted">MD (readable) · PDF: Setting Up Real Image Manipulation on Your Local Server.pdf</div>
              </div>
            </li>

            <li class="file" data-path="./Using 1040 until 3060 Gets Here.txt" data-pdf="./Using 1040 until 3060 Gets Here.txt">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">Using 1040 until 3060 Gets Here</a></div>
                <div class="desc">Tactical guidance and default model choices while on CPU / GTX 1040, with suggested timeouts and quick model picks.</div>
                <div class="tags small-muted">text file · Guides</div>
              </div>
            </li>

            <li class="file" data-path="./Claude session - started the whole rabbit trail of hosting my own LLM.md" data-pdf="">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">Claude session - started the whole rabbit trail of hosting my own LLM.md</a></div>
                <div class="desc">Experiment notes: commit-message automation approaches, Ollama examples, costs, and a copilot-like script for local usage.</div>
                <div class="tags small-muted">MD · Guides</div>
              </div>
            </li>

<li class="file" data-path="./Prep for 3060 - in the mean time as well.txt" data-pdf="">
  <div class="meta">
    <div class="title"><a href="#" class="file-link">Prep for 3060 - in the mean time as well</a></div>
    <div class="desc">Preparation checklist and setup notes saved as plain text (converted from DOCX). Treat as a Guide; convert to MD for full searchability.</div>
    <div class="tags small-muted">TXT · Guides</div>
  </div>
</li>

            <li class="file" data-path="./md_outputs/RTX 3060 Setup Guide - Complete AI Coding Workflow.md" data-pdf="./RTX 3060 Setup Guide - Complete AI Coding Workflow.pdf">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">RTX 3060 Setup Guide - Complete AI Coding Workflow (md)</a></div>
                <div class="desc">Converted from PDF: hardware & software phases, model pulls (qwen2.5-coder:14b, deepseek-coder-v2:16b), Continue config and benchmarks.</div>
                <div class="tags small-muted">MD · PDF available</div>
              </div>
            </li>

            <li class="file" data-path="./md_outputs/Setting Up Real Image Manipulation on Your Local Server.md" data-pdf="./Setting Up Real Image Manipulation on Your Local Server.pdf">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">Setting Up Real Image Manipulation on Your Local Server (md)</a></div>
                <div class="desc">Converted from PDF: ComfyUI + Flux install, models, Manager, workflows and Open WebUI integration.</div>
                <div class="tags small-muted">MD · PDF available</div>
              </div>
            </li>

            <li class="file" data-path="./md_outputs/Open WebUI Management Guide.md" data-pdf="./Open WebUI Management Guide.pdf">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">Open WebUI Management Guide (md)</a></div>
                <div class="desc">Converted management guide: NSSM service commands, webui.db locations, backups and Cloudflare tunnel notes.</div>
                <div class="tags small-muted">MD · PDF available</div>
              </div>
            </li>

            <li class="file" data-path="./md_outputs/AIChat CLI_ Capabilities and User Guide Summary.md" data-pdf="./AIChat CLI_ Capabilities and User Guide Summary.pdf">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">AIChat CLI: Capabilities and User Guide Summary (md)</a></div>
                <div class="desc">Converted from PDF: modes (one-liner, REPL, shell assistant), context (-f), roles (-r), RAG and local API serve mode.</div>
                <div class="tags small-muted">MD · PDF available</div>
              </div>
            </li>

          
            <li class="file" data-path="./Image Generation Options for Open WebUI.pdf" data-pdf="./Image Generation Options for Open WebUI.pdf">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">Image Generation Options for Open WebUI</a></div>
                <div class="desc">image gen</div>
                <div class="tags small-muted">PDF · Guides (setup, long-form)</div>
              </div>
            </li>
</ul>
        </section>

        <!-- Quick refs -->
        <section class="category" data-category="QuickRefs">
          <h2>Quick references / cheat sheets</h2>
          <ul class="files" id="quickList">
            <li class="file" data-path="./Quantization & Context Tokens — A One‑Page Practical Guide.md" data-pdf="./Quantization & Context Tokens — A One‑Page Practical Guide.md">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">Quantization & Context Tokens — A One‑Page Practical Guide.md</a></div>
                <div class="desc">Token heuristics and practical summary of quantization labels (Q4_K_M, Q4_0, BF16, FP8). Good cheat-sheet for offline decisions.</div>
                <div class="tags small-muted">MD · QuickRef</div>
              </div>
            </li>

            <li class="file" data-path="./Quantization and Context Tokens — One‑Page Guide.html" data-pdf="./Quantization and Context Tokens — One‑Page Guide.html">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">Quantization and Context Tokens — One‑Page Guide.html</a></div>
                <div class="desc">HTML view of the one-page guide (open in browser for nicely formatted view).</div>
                <div class="tags small-muted">HTML · QuickRef</div>
              </div>
            </li>

            <li class="file" data-path="./LLM QUICK SELECTION GUIDE.txt" data-pdf="./LLM QUICK SELECTION GUIDE.txt">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">LLM QUICK SELECTION GUIDE.txt</a></div>
                <div class="desc">Quick model-selection cheat sheet: what model to use for reasoning, coding, vision, or speed.</div>
                <div class="tags small-muted">TXT · QuickRef</div>
              </div>
            </li>

            <li class="file" data-path="./Ollama Download Commands for Recommended LLMs.pdf" data-pdf="./Ollama Download Commands for Recommended LLMs.pdf">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">Ollama Download Commands for Recommended LLMs.pdf</a></div>
                <div class="desc">PDF with quick `ollama pull` commands — useful to reference when provisioning models.</div>
                <div class="tags small-muted">PDF · QuickRef</div>
              </div>
            </li>

          
            <li class="file" data-path="./Doc_INDEX_Version6.md" data-pdf="">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">Doc_INDEX_Version6</a></div>
                <div class="desc">Curated toc</div>
                <div class="tags small-muted">MD · Quick references / cheat sheets</div>
              </div>
            </li>
<li class="file" data-path="./md_outputs/LLM Infrastructure Cheat Sheet (Updated).md" data-pdf="./LLM Infrastructure Cheat Sheet (Updated).pdf">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">LLM Infrastructure Cheat Sheet (Updated)</a></div>
                <div class="desc"></div>
                <div class="tags small-muted">MD · Quick references / cheat sheets</div>
              </div>
            </li></ul>
        </section>

        <!-- Models -->
        <section class="category" data-category="Models">
          <h2>Models & inventory</h2>
          <ul class="files" id="modelsList">
            <li class="file" data-path="./Ollama Models as of 2025 11 18.txt" data-pdf="./Ollama Models as of 2025 11 18.txt">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">Ollama Models as of 2025 11 18</a></div>
                <div class="desc">Model-by-model essentials, suggested defaults, and quantization notes — guidance for what to keep and what to pull for the 3060.</div>
                <div class="tags small-muted">text · Models</div>
              </div>
            </li>

            <li class="file" data-path="./GROK.recommended.llms.w.RTX.3060.txt" data-pdf="./GROK.recommended.llms.w.RTX.3060.txt">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">GROK.recommended.llms.w.RTX.3060.txt</a></div>
                <div class="desc">Recommended pulls and priority list for RTX 3060 12GB; includes one-line commands to pull recommended models.</div>
                <div class="tags small-muted">TXT · Models</div>
              </div>
            </li>

            <li class="file" data-path="./GROK.recommended.nano.banana.replacement.txt" data-pdf="./GROK.recommended.nano.banana.replacement.txt">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">GROK.recommended.nano.banana.replacement.txt</a></div>
                <div class="desc">Image-focused recommendations: ComfyUI + Flux (FP8) and the best local tools for image restoration/editing.</div>
                <div class="tags small-muted">TXT · Models / Image</div>
              </div>
            </li>

            <li class="file" data-path="./ollama-ls.txt" data-pdf="./ollama-ls.txt">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">ollama-ls.txt</a></div>
                <div class="desc">Raw output of `ollama ls` showing installed models and sizes (useful for cleanup planning).</div>
                <div class="tags small-muted">TXT · Models</div>
              </div>
            </li>

            <li class="file" data-path="./ollama-show-out.txt" data-pdf="./ollama-show-out.txt">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">ollama-show-out.txt</a></div>
                <div class="desc">Collected `ollama show` output for many models with quantization, context lengths and capabilities listed.</div>
                <div class="tags small-muted">TXT · Models</div>
              </div>
            </li>

            <li class="file" data-path="./ollama website list - LLM.txt" data-pdf="./ollama website list - LLM.txt">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">ollama website list - LLM.txt</a></div>
                <div class="desc">Catalog of model families, sizes and short descriptions to inform pull decisions.</div>
                <div class="tags small-muted">TXT · Models</div>
              </div>
            </li>

          </ul>
        </section>

        <!-- Workflows -->
        <section class="category" data-category="Workflows">
          <h2>Workflows & automation</h2>
          <ul class="files" id="workflowsList">

            <li class="file" data-path="./OpenWebUI — Task Scheduler CLI Reference.txt" data-pdf="./OpenWebUI — Task Scheduler CLI Reference.txt">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">OpenWebUI — Task Scheduler CLI Reference.txt</a></div>
                <div class="desc">Run OpenWebUI via Task Scheduler at startup (SYSTEM): run script sample, schtasks commands, and logging/debugging tips.</div>
                <div class="tags small-muted">TXT · Workflows</div>
              </div>
            </li>

            <li class="file" data-path="./Open WebUI Installation Guide for Windows 11.pdf" data-pdf="./Open WebUI Installation Guide for Windows 11.pdf">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">Open WebUI Installation Guide for Windows 11.pdf</a></div>
                <div class="desc">Installer and service notes; refer to md_outputs/ if converted for management commands.</div>
                <div class="tags small-muted">PDF · Workflows</div>
              </div>
            </li>

            <li class="file" data-path="./md_outputs/Open WebUI Management Guide.md" data-pdf="./Open WebUI Management Guide.pdf">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">Open WebUI Management Guide (md)</a></div>
                <div class="desc">Converted from PDF: management commands, service notes, and backup recommendations.</div>
                <div class="tags small-muted">MD · Workflows</div>
              </div>
            </li>

          </ul>
        </section>

        <!-- Scripts & other -->
        <section class="category" data-category="Scripts">
          <h2>Scripts & small artifacts</h2>
          <ul class="files" id="scriptsList">
            <li class="file" data-path="./What to Try Next.txt" data-pdf="./What to Try Next.txt">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">What to Try Next.txt</a></div>
                <div class="desc">Short list of experiments and models to try next using your local setup.</div>
                <div class="tags small-muted">TXT</div>
              </div>
            </li>

            <li class="file" data-path="./a.txt" data-pdf="./a.txt">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">a</a></div>
                <div class="desc">Small file listing `ollama show` commands (binary/encoded text in places).</div>
                <div class="tags small-muted">misc</div>
              </div>
            </li>

            <li class="file" data-path="./ollama-show.bat" data-pdf="./ollama-show.bat">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">ollama-show.bat</a></div>
                <div class="desc">Windows batch to run a set of `ollama show` commands quickly.</div>
                <div class="tags small-muted">BAT</div>
              </div>
            </li>

          </ul>
        </section>

      
        <section class="category" data-category="Junk">
          <h2>Junk</h2>
          <ul class="files">

            <li class="file" data-path="./.DS_Store" data-pdf="">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">DS Store Junk</a></div>
                <div class="desc">Nothing</div>
                <div class="tags small-muted">file · Junk</div>
              </div>
            </li>

          <li class="file" data-path="./Doc_index.html" data-pdf="">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">Doc_index</a></div>
                <div class="desc">old index</div>
                <div class="tags small-muted">HTML · Junk</div>
              </div>
            </li><li class="file" data-path="./Doc_index_Version2.html" data-pdf="">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">Doc_index_Version2</a></div>
                <div class="desc">old index</div>
                <div class="tags small-muted">HTML · Junk</div>
              </div>
            </li><li class="file" data-path="./LLM Infrastructure Cheat Sheet (Updated).pdf" data-pdf="./LLM Infrastructure Cheat Sheet (Updated).pdf">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">LLM Infrastructure Cheat Sheet (Updated)</a></div>
                <div class="desc"></div>
                <div class="tags small-muted">PDF · Junk</div>
              </div>
            </li><li class="file" data-path="./LLM Infrastructure Cheat Sheet_old.pdf" data-pdf="./LLM Infrastructure Cheat Sheet_old.pdf">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">LLM Infrastructure Cheat Sheet_old</a></div>
                <div class="desc"></div>
                <div class="tags small-muted">PDF · Junk</div>
              </div>
            </li><li class="file" data-path="./LLM Recommendations for Programming and Development.pdf" data-pdf="./LLM Recommendations for Programming and Development.pdf">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">LLM Recommendations for Programming and Development</a></div>
                <div class="desc"></div>
                <div class="tags small-muted">PDF · Junk</div>
              </div>
            </li><li class="file" data-path="./Rtx3060 Supplemental Improvements.pdf" data-pdf="./Rtx3060 Supplemental Improvements.pdf">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">Rtx3060 Supplemental Improvements</a></div>
                <div class="desc"></div>
                <div class="tags small-muted">PDF · Junk</div>
              </div>
            </li><li class="file" data-path="./~$ep for 3060 - in the mean time as well.txt" data-pdf="">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">~$ep for 3060 - in the mean time as well</a></div>
                <div class="desc"></div>
                <div class="tags small-muted">TXT · Junk</div>
              </div>
            </li><li class="file" data-path="./md_outputs/Image Generation Options for Open WebUI.md" data-pdf="./Image Generation Options for Open WebUI.pdf">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">Image Generation Options for Open WebUI</a></div>
                <div class="desc"></div>
                <div class="tags small-muted">MD · Junk</div>
              </div>
            </li><li class="file" data-path="./md_outputs/LLM Infrastructure Cheat Sheet_old.md" data-pdf="./LLM Infrastructure Cheat Sheet_old.pdf">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">LLM Infrastructure Cheat Sheet_old</a></div>
                <div class="desc"></div>
                <div class="tags small-muted">MD · Junk</div>
              </div>
            </li><li class="file" data-path="./md_outputs/LLM Recommendations for Programming and Development.md" data-pdf="./LLM Recommendations for Programming and Development.pdf">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">LLM Recommendations for Programming and Development</a></div>
                <div class="desc"></div>
                <div class="tags small-muted">MD · Junk</div>
              </div>
            </li><li class="file" data-path="./md_outputs/Rtx3060 Supplemental Improvements.md" data-pdf="./Rtx3060 Supplemental Improvements.pdf">
              <div class="meta">
                <div class="title"><a href="#" class="file-link">Rtx3060 Supplemental Improvements</a></div>
                <div class="desc"></div>
                <div class="tags small-muted">MD · Junk</div>
              </div>
            </li></ul>
        </section>

        

        

        

        

        

        

        

        

        

        

        

        
</div>
    </aside>

    <section id="viewer" aria-label="Document viewer">
      <div id="viewerHeader">
        <h3 id="viewerTitle">Select a file to preview</h3>
        <div class="small-muted" id="viewerInfo">Files render client-side. Markdown will be converted to HTML. PDFs embedded if supported by browser.</div>
      </div>
      <div id="viewerBody">
        <div id="content">
          <div id="mdViewer" style="display:none"></div>
          <iframe id="pdfViewer" style="display:none;width:100%;height:75vh;border:0;border-radius:8px" sandbox="allow-same-origin allow-scripts allow-forms"></iframe>
          <div id="rawViewer" style="display:none"></div>
        </div>
      </div>
    </section>
  </main>

  <script>
    // Helper to decode entities
    function safeFetchText(path){
      return fetch(path).then(r=>{
        if(!r.ok) throw new Error('Fetch failed '+r.status);
        return r.text();
      });
    }

    // Render markdown content into mdViewer using marked.js
    const mdViewer = document.getElementById('mdViewer');
    const pdfViewer = document.getElementById('pdfViewer');
    const rawViewer = document.getElementById('rawViewer');
    const viewerTitle = document.getElementById('viewerTitle');
    const viewerInfo = document.getElementById('viewerInfo');
    const searchInput = document.getElementById('searchInput');
    const resultCount = document.getElementById('resultCount');

    // Initialize file-link click handlers
    document.querySelectorAll('.file-link').forEach(link=>{
      link.addEventListener('click', (ev)=>{
        ev.preventDefault();
        const li = ev.target.closest('.file');
        openFilePreview(li);
      });
    });

    // Determine type by extension
    function extOf(path){
      const m = path.split('.').pop().toLowerCase();
      return m;
    }

    function openFilePreview(li){
      const path = li.dataset.path;
      const pdf = li.dataset.pdf || '';
      viewerTitle.textContent = li.querySelector('.title').innerText;
      // hide all viewers
      mdViewer.style.display = 'none';
      pdfViewer.style.display = 'none';
      rawViewer.style.display = 'none';
      // If MD file (or md_outputs) — render
      const e = extOf(path);
      if(e === 'md' || path.endsWith('.md') || path.includes('md_outputs')){
        // prefer MD (path), if path points to an MD file present
        safeFetchText(path).then(txt=>{
          // If the MD contains a frontmatter + large content, strip nothing — marked will handle.
          mdViewer.innerHTML = marked.parse(txt);
          mdViewer.style.display = 'block';
          // Add small link to original PDF if available
          if(pdf){
            const orig = document.createElement('div');
            orig.className = 'small-muted';
            orig.innerHTML = `Source PDF: <a class="inline-link" href="${pdf}" target="_blank" rel="noopener">${pdf}</a>`;
            if(mdViewer.firstChild) mdViewer.insertBefore(orig, mdViewer.firstChild);
            else mdViewer.appendChild(orig);
          }
        }).catch(err=>{
          rawViewer.style.display = 'block';
          rawViewer.textContent = 'Failed to load markdown: ' + err;
        });
        return;
      }
      // If PDF (or user wants the PDF)
      if(e === 'pdf' || pdf.toLowerCase().endsWith('.pdf')){
        const pdfPath = (e === 'pdf') ? path : pdf;
        pdfViewer.src = pdfPath;
        pdfViewer.style.display = 'block';
        return;
      }
      // If DOCX or other binary: show link to open externally
      if(e === 'docx' || e === 'doc'){
        rawViewer.style.display = 'block';
        rawViewer.innerHTML = `This is a binary Office file. <a class="inline-link" href="${path}" target="_blank" rel="noopener">Open ${path}</a>`;
        return;
      }
      // For plain text files
      if(['txt','log','out'].includes(e) || e.length<=4){
        safeFetchText(path).then(txt=>{
          rawViewer.style.display = 'block';
          // textContent preserves newlines as characters, CSS 'white-space: pre-wrap' ensures they are rendered as line breaks
          rawViewer.textContent = txt;
        }).catch(err=>{
          rawViewer.style.display = 'block';
          rawViewer.textContent = 'Failed to load file: ' + err;
        });
        return;
      }
      // Fallback: open in new tab
      rawViewer.style.display = 'block';
      rawViewer.innerHTML = `Open file: <a class="inline-link" href="${path}" target="_blank" rel="noopener">${path}</a>`;
    }

    // Simple client-side filter
    function filterFiles(q){
      q = (q||'').toLowerCase().trim();
      const files = document.querySelectorAll('li.file');
      let visible = 0;
      files.forEach(li=>{
        const title = li.querySelector('.title').innerText.toLowerCase();
        const desc = li.querySelector('.desc').innerText.toLowerCase();
        const tags = li.querySelector('.tags').innerText.toLowerCase();
        if(!q || title.includes(q) || desc.includes(q) || tags.includes(q)){
          li.style.display = '';
          visible++;
        } else {
          li.style.display = 'none';
        }
      });
      resultCount.textContent = visible ? `${visible} shown` : 'no results';
    }

    searchInput.addEventListener('input', (e)=>{
      filterFiles(e.target.value);
    });

    // on load: if hash present, open file
    window.addEventListener('load', ()=>{
      const hash = decodeURIComponent(location.hash.replace(/^#/,''));
      if(hash){
        // find file with matching data-path or title
        const el = Array.from(document.querySelectorAll('li.file')).find(li=>{
          return li.dataset.path===hash || li.dataset.pdf===hash || li.querySelector('.title').innerText===hash;
        });
        if(el) openFilePreview(el);
      }
      filterFiles('');
    });

    // For keyboard: press "/" to focus search
    window.addEventListener('keydown', (e)=>{
      if(e.key==='/' && document.activeElement !== searchInput){
        e.preventDefault();
        searchInput.focus();
        searchInput.select();
      }
    });
  </script>
</body>
</html>
